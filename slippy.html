<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript" src="jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="jquery.hotkeys.js"></script>

<link rel="stylesheet" href="leaflet-derived/leaflet.css" />
 <!--[if lte IE 8]>
     <link rel="stylesheet" href="leaflet-derived/leaflet.ie.css" />
 <![endif]-->
<script src="leaflet-derived/leaflet-src.js"></script>

<script type="text/javascript">
$(document).ready(function() {
	$("#clearcacheclick").click(function() { clearTileCache(); return false; });
	indexedtile_onready = function(){
		var map = L.map('map').setView([51.505, -0.09], 13);
		L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
			maxZoom: 19
		}).addTo(map);
	};

	if(navigator.geolocation){
		var geolocme = function(){
			navigator.geolocation.getCurrentPosition( function (userloc) {
				userlon = userloc.coords.longitude;
				userlat = userloc.coords.latitude;
				//alert("" + userlon + ", " + userlat);
				var fromProjection = new OpenLayers.Projection("EPSG:4326"); // transform from WGS 1984
				var toProjection = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
				L.map('map').zoomToExtent(new OpenLayers.Bounds(
				   (userlon-0.15), (userlat-0.075), (userlon+0.15), (userlat+0.075)
				).transform(fromProjection,toProjection));
			});
			return false;
		};
		$("#geolocmebutton").click(geolocme);
	}else{
		$("#geolocmebutton").style.display = "none";
	}

}); // end onload
</script>

<title>Slippy tiles</title>
<script type="text/javascript" src="indexedtile.js"></script>
<style type="text/css">
body { text-align: center; }
img, div {margin: 0px; padding: 0px;}
#map { height: 400px; width: 98%; margin: 0; }
.lowerbutton { margin: 1ex; padding: 1ex; }
</style>
</head>
	<body>
		<h1>Slippy tiles</h1>
		<p>is it live or is it IndexedDB?</p>

 <div id="map"></div>

	<p class="lowerbutton"><a href="#" id="geolocmebutton">Geolocate me</a></p>
	<p class="lowerbutton"><a href="#" id="clearcacheclick">Clear tile cache</a></p>

	</body>
</html>

